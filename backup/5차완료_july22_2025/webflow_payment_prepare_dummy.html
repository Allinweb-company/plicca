
<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ê²°ì œ ì¤€ë¹„ - Webflow</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .payment-container {
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.1);
            padding: 40px;
            max-width: 600px;
            width: 100%;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
        }

        .header h1 {
            color: #333;
            font-size: 2rem;
            margin-bottom: 10px;
        }

        .order-info {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 30px;
        }

        .info-row {
            display: flex;
            justify-content: space-between;
            padding: 10px 0;
            border-bottom: 1px solid #e9ecef;
        }

        .info-row:last-child {
            border-bottom: none;
            font-weight: bold;
            font-size: 1.2rem;
        }

        .info-label {
            color: #666;
            font-weight: 500;
        }

        .info-value {
            color: #333;
            font-weight: 600;
        }

        .amount {
            color: #e74c3c !important;
            font-size: 1.5rem !important;
        }

        .payment-btn {
            width: 100%;
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            border: none;
            padding: 20px;
            border-radius: 15px;
            font-size: 1.3rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-bottom: 20px;
        }

        .payment-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 30px rgba(102, 126, 234, 0.3);
        }

        .loading {
            display: none;
            text-align: center;
            color: #666;
            margin-top: 20px;
        }

        .spinner {
            border: 3px solid #f3f3f3;
            border-top: 3px solid #667eea;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 15px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .processing-window {
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            z-index: 1000;
            text-align: center;
        }

        .overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 999;
        }
    </style>
</head>
<body>
    <div class="overlay" id="overlay"></div>
    
    <div class="processing-window" id="processingWindow">
        <div class="spinner"></div>
        <h3>ê²°ì œ ìŠ¹ì¸ ì²˜ë¦¬ ì¤‘...</h3>
        <p>PHP ì„œë²„ì—ì„œ ê²°ì œ ìŠ¹ì¸ì„ ì§„í–‰í•˜ê³  ìˆìŠµë‹ˆë‹¤.</p>
        <p><small>ì°½ì„ ë‹«ì§€ ë§ˆì„¸ìš”.</small></p>
    </div>

    <div class="payment-container">
        <div class="header">
            <h1>ğŸ’³ ê²°ì œ ì¤€ë¹„</h1>
            <p>ì£¼ë¬¸ ì •ë³´ë¥¼ í™•ì¸í•˜ê³  ê²°ì œë¥¼ ì§„í–‰í•´ì£¼ì„¸ìš”</p>
        </div>

        <div class="order-info">
            <div class="info-row">
                <span class="info-label">ì£¼ë¬¸ë²ˆí˜¸</span>
                <span class="info-value" id="orderNo">1752367824262</span>
            </div>
            <div class="info-row">
                <span class="info-label">ìƒí’ˆëª…</span>
                <span class="info-value" id="productName">111ì˜¬ì¸ì›¹</span>
            </div>
            <div class="info-row">
                <span class="info-label">ìˆ˜ëŸ‰</span>
                <span class="info-value" id="quantity">12ê°œ</span>
            </div>
            <div class="info-row">
                <span class="info-label">ì£¼ë¬¸ì</span>
                <span class="info-value" id="customerName">ê¹€ì„±ê³¤</span>
            </div>
            <div class="info-row">
                <span class="info-label">ê²°ì œê¸ˆì•¡</span>
                <span class="info-value amount" id="totalAmount">132ì›</span>
            </div>
        </div>

        <button id="paymentBtn" class="payment-btn">
            ğŸš€ ê²°ì œì°½ ì—´ê¸°
        </button>

        <div id="loading" class="loading">
            <div class="spinner"></div>
            <p>ê²°ì œì°½ì„ ì—¬ëŠ” ì¤‘ì…ë‹ˆë‹¤...</p>
        </div>

        <!-- ìˆ¨ê²¨ì§„ ê²°ì œ í¼ -->
        <form name="payInit" id="paymentForm" method="post" style="display: none;">
            <input type="hidden" name="payMethod" value="card">
            <input type="hidden" name="mid" value="mimich067m">
            <input type="hidden" name="trxCd" value="0">
            <input type="hidden" name="goodsNm" value="111ì˜¬ì¸ì›¹">
            <input type="hidden" name="ordNo" value="1752367824262">
            <input type="hidden" name="goodsAmt" value="132">
            <input type="hidden" name="ordNm" value="ê¹€ì„±ê³¤">
            <input type="hidden" name="ordTel" value="01022691000">
            <input type="hidden" name="ordEmail" value="4u@all-in-web.kr">
            <input type="hidden" name="returnUrl" value="">
            <input type="hidden" name="notiUrl" value="">
            <input type="hidden" name="userIp" value="172.31.128.118">
            <input type="hidden" name="mbsUsrId" value="api_user_012646">
            <input type="hidden" name="mbsReserved" value="APIRequest">
            <input type="hidden" name="charSet" value="UTF-8">
            <input type="hidden" name="ediDate" value="20250713012646">
            <input type="hidden" name="encData" value="37f44483491ce9fa4e828289722c7dbea9aa76c0e443297d1a95de3686d7177a">
        </form>
    </div>

    <!-- Fintree JavaScript SDK -->
    <script src="https://api.fintree.kr/js/v1/pgAsistant.js"></script>

    <script>
        const WEBFLOW_URL = window.location.href;

        document.addEventListener('DOMContentLoaded', function() {
            console.log('ğŸ”„ Webflow ê²°ì œ í˜ì´ì§€ ë¡œë“œ ì‹œì‘');
            setupPaymentForm();
            checkPaymentResult();
        });

        function setupPaymentForm() {
            // â­ ìƒˆì°½ì—ì„œ PHP ìŠ¹ì¸ ì²˜ë¦¬ í›„ Webflowë¡œ ëŒì•„ì˜¤ë„ë¡ ì„¤ì •
            const serverReturnUrl = `https://w110.winnerit.co.kr/payment_result.php?webflowUrl=${encodeURIComponent(WEBFLOW_URL)}`;

            const form = document.getElementById('paymentForm');
            form.action = serverReturnUrl;
            form.returnUrl.value = serverReturnUrl;

            console.log('âœ… Webflow ê²°ì œ í¼ ì„¤ì • ì™„ë£Œ');
            console.log('ğŸ”„ Server Return URL:', serverReturnUrl);
        }

        // ê²°ì œ ë²„íŠ¼ ì´ë²¤íŠ¸
        document.getElementById('paymentBtn').addEventListener('click', function() {
            if (typeof SendPay === 'undefined') {
                alert('Fintree ê²°ì œ ëª¨ë“ˆì´ ë¡œë”©ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤. í˜ì´ì§€ë¥¼ ìƒˆë¡œê³ ì¹¨í•´ì£¼ì„¸ìš”.');
                return;
            }

            console.log('ğŸš€ Webflowì—ì„œ ê²°ì œì°½ í˜¸ì¶œ ì‹œì‘');

            this.style.display = 'none';
            document.getElementById('loading').style.display = 'block';

            try {
                console.log('ğŸ“¤ SendPay í•¨ìˆ˜ í˜¸ì¶œ - PHP ì„œë²„ ê²½ìœ ');
                SendPay(document.getElementById('paymentForm'));
            } catch (error) {
                console.error('âŒ ê²°ì œì°½ ì˜¤í”ˆ ì˜¤ë¥˜:', error);
                alert('ê²°ì œì°½ì„ ì—¬ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + error.message);
                this.style.display = 'block';
                document.getElementById('loading').style.display = 'none';
            }
        });

        // â­ í•µì‹¬: ê²°ì œ ì™„ë£Œ ì½œë°± - ìƒˆì°½ì—ì„œ PHP ìŠ¹ì¸ ì²˜ë¦¬
        function pay_result_submit() {
            console.log('âœ… Webflow ê²°ì œ ì™„ë£Œ - PHP ìŠ¹ì¸ ì²˜ë¦¬ ì‹œì‘');
            
            // ìŠ¹ì¸ ì²˜ë¦¬ í‘œì‹œ
            showProcessingWindow();
            
            // â­ ìƒˆì°½ì—ì„œ PHP ìŠ¹ì¸ ì²˜ë¦¬ í˜ì´ì§€ ì§ì ‘ ì—´ê¸°
            const serverUrl = `https://w110.winnerit.co.kr/payment_result.php?webflowUrl=${encodeURIComponent(WEBFLOW_URL)}`;
            
            const approvalWindow = window.open(
                serverUrl,  // â­ ì‹¤ì œ PHP í˜ì´ì§€ URL ì§€ì •
                'paymentApproval',
                'width=900,height=800,scrollbars=yes,resizable=yes'
            );
            
            // ìƒˆì°½ì´ ì—´ë ¸ëŠ”ì§€ í™•ì¸
            if (!approvalWindow) {
                alert('íŒì—…ì´ ì°¨ë‹¨ë˜ì—ˆìŠµë‹ˆë‹¤. íŒì—… í—ˆìš© í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.');
                hideProcessingWindow();
                document.getElementById('paymentBtn').style.display = 'block';
                document.getElementById('loading').style.display = 'none';
                return;
            }
            
            // ë¶€ëª¨ì°½ì—ì„œ ê²°ê³¼ ìˆ˜ì‹  í•¨ìˆ˜ ë“±ë¡ (ìƒˆì°½ì—ì„œ í˜¸ì¶œìš©)
            window.onPaymentComplete = function(resultData) {
                console.log('ğŸ‰ ìƒˆì°½ì—ì„œ ìŠ¹ì¸ ê²°ê³¼ ìˆ˜ì‹ :', resultData);
                hideProcessingWindow();
                
                if (resultData.result === '00') {
                    alert(`âœ… ê²°ì œ ìŠ¹ì¸ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤!\nì£¼ë¬¸ë²ˆí˜¸: ${resultData.ordNo}\nTID: ${resultData.tid}\nìŠ¹ì¸ë²ˆí˜¸: ${resultData.appNo || 'N/A'}`);
                } else {
                    alert(`âŒ ê²°ì œ ìŠ¹ì¸ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.\nì‚¬ìœ : ${resultData.resultMsg || 'ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜'}`);
                }
                
                // ë²„íŠ¼ ë³µì›
                document.getElementById('paymentBtn').style.display = 'block';
                document.getElementById('loading').style.display = 'none';
            };
            
            // â­ payResultSubmit() ëŒ€ì‹  ìƒˆì°½ì—ì„œ í¼ ì œì¶œ
            // í˜„ì¬ ì°½ì€ ê·¸ëŒ€ë¡œ ìœ ì§€í•˜ê³  ìƒˆì°½ì—ì„œë§Œ ì²˜ë¦¬
            const form = document.getElementById('paymentForm');
            form.target = 'paymentApproval';  // ìƒˆì°½ìœ¼ë¡œ ì œì¶œ
            
            // Fintree ê¸°ë³¸ í•¨ìˆ˜ í˜¸ì¶œí•˜ë˜ ìƒˆì°½ìœ¼ë¡œ ì²˜ë¦¬
            payResultSubmit();
        }

        function pay_result_close() {
            console.log('âŒ Webflow ê²°ì œ ì·¨ì†Œ');
            hideProcessingWindow();
            document.getElementById('loading').style.display = 'none';
            document.getElementById('paymentBtn').style.display = 'block';
            alert('ê²°ì œë¥¼ ì·¨ì†Œí•˜ì˜€ìŠµë‹ˆë‹¤.');
        }

        function showProcessingWindow() {
            document.getElementById('overlay').style.display = 'block';
            document.getElementById('processingWindow').style.display = 'block';
        }

        function hideProcessingWindow() {
            document.getElementById('overlay').style.display = 'none';
            document.getElementById('processingWindow').style.display = 'none';
        }

        // ê²°ì œ ì™„ë£Œ í›„ ëŒì•„ì™”ì„ ë•Œ ê²°ê³¼ ì²˜ë¦¬ (GET íŒŒë¼ë¯¸í„°)
        function checkPaymentResult() {
            const urlParams = new URLSearchParams(window.location.search);
            if (urlParams.get('result')) {
                const resultData = {
                    result: urlParams.get('result'),
                    ordNo: urlParams.get('ordNo'),
                    tid: urlParams.get('tid'),
                    amt: urlParams.get('amt'),
                    appNo: urlParams.get('appNo'),
                    resultMsg: urlParams.get('resultMsg')
                };

                console.log('ğŸ‰ Webflow ê²°ì œ ê²°ê³¼ ìˆ˜ì‹ :', resultData);

                if (resultData.result === '00') {
                    alert(`âœ… ê²°ì œê°€ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤!\nì£¼ë¬¸ë²ˆí˜¸: ${resultData.ordNo}\nTID: ${resultData.tid}\nìŠ¹ì¸ë²ˆí˜¸: ${resultData.appNo || 'N/A'}`);
                } else {
                    alert(`âŒ ê²°ì œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.\nì‚¬ìœ : ${resultData.resultMsg || 'ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜'}`);
                }

                // URL íŒŒë¼ë¯¸í„° ì œê±°
                const cleanUrl = window.location.protocol + '//' + window.location.host + window.location.pathname;
                window.history.replaceState({}, document.title, cleanUrl);
            }
        }
    </script>
</body>
</html>
