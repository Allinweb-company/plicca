<!DOCTYPE html>
<html lang="ko" data-bs-theme="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PC ê²°ì œ í…ŒìŠ¤íŠ¸ ì§„ë‹¨</title>
    <link href="https://cdn.replit.com/agent/bootstrap-agent-dark-theme.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        .diagnostic-card {
            background: linear-gradient(135deg, #1a1d23 0%, #2d3748 100%);
            border: 1px solid #4a5568;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        }
        .test-result {
            padding: 10px;
            border-radius: 8px;
            margin: 5px 0;
        }
        .test-pass { background-color: #065f46; border: 1px solid #059669; }
        .test-fail { background-color: #7f1d1d; border: 1px solid #dc2626; }
        .test-warn { background-color: #78350f; border: 1px solid #d97706; }
    </style>
</head>
<body class="bg-dark text-light">
    <div class="container py-5">
        <div class="row justify-content-center">
            <div class="col-lg-10">
                <div class="diagnostic-card p-4">
                    <div class="text-center mb-4">
                        <h2 class="text-info">
                            <i class="fas fa-desktop me-2"></i>
                            PC ê²°ì œ ë¬¸ì œ ì§„ë‹¨ ë„êµ¬
                        </h2>
                        <p class="text-muted">PCì—ì„œ ê²°ì œê°€ ì•ˆë˜ëŠ” ì›ì¸ì„ ì°¾ì•„ë³´ê² ìŠµë‹ˆë‹¤</p>
                    </div>

                    <!-- ì§„ë‹¨ ê²°ê³¼ ì˜ì—­ -->
                    <div id="diagnosticResults" class="mb-4">
                        <h5 class="text-warning mb-3">
                            <i class="fas fa-search me-2"></i>
                            ì§„ë‹¨ ê²°ê³¼
                        </h5>
                        <div id="testResults"></div>
                    </div>

                    <!-- í™˜ê²½ ì •ë³´ -->
                    <div class="mb-4">
                        <h5 class="text-warning mb-3">
                            <i class="fas fa-info-circle me-2"></i>
                            ë¸Œë¼ìš°ì € í™˜ê²½ ì •ë³´
                        </h5>
                        <div class="data-display p-3" style="background: #2d3748; border-radius: 10px; border: 1px solid #4a5568;">
                            <div class="row">
                                <div class="col-md-6">
                                    <p><strong>ë¸Œë¼ìš°ì €:</strong> <span id="browserInfo" class="text-info"></span></p>
                                    <p><strong>ë””ë°”ì´ìŠ¤:</strong> <span id="deviceType" class="text-success"></span></p>
                                    <p><strong>í™”ë©´ í¬ê¸°:</strong> <span id="screenSize" class="text-warning"></span></p>
                                </div>
                                <div class="col-md-6">
                                    <p><strong>User Agent:</strong> <span id="userAgent" class="text-secondary small"></span></p>
                                    <p><strong>JavaScript:</strong> <span id="jsEnabled" class="text-info"></span></p>
                                    <p><strong>íŒì—… í—ˆìš©:</strong> <span id="popupTest" class="text-danger"></span></p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- í…ŒìŠ¤íŠ¸ ë²„íŠ¼ë“¤ -->
                    <div class="row">
                        <div class="col-md-4 mb-3">
                            <button id="popupTestBtn" class="btn btn-primary w-100">
                                <i class="fas fa-window-maximize me-2"></i>
                                íŒì—… í…ŒìŠ¤íŠ¸
                            </button>
                        </div>
                        <div class="col-md-4 mb-3">
                            <button id="sdkTestBtn" class="btn btn-info w-100">
                                <i class="fas fa-code me-2"></i>
                                Fintree SDK í…ŒìŠ¤íŠ¸
                            </button>
                        </div>
                        <div class="col-md-4 mb-3">
                            <button id="paymentTestBtn" class="btn btn-success w-100">
                                <i class="fas fa-credit-card me-2"></i>
                                ê²°ì œì°½ í…ŒìŠ¤íŠ¸
                            </button>
                        </div>
                    </div>

                    <!-- í•´ê²° ë°©ì•ˆ -->
                    <div class="mt-4">
                        <h5 class="text-warning mb-3">
                            <i class="fas fa-tools me-2"></i>
                            ë¬¸ì œ í•´ê²° ë°©ì•ˆ
                        </h5>
                        <div id="solutions" class="data-display p-3" style="background: #2d3748; border-radius: 10px; border: 1px solid #4a5568;">
                            <div id="solutionsList"></div>
                        </div>
                    </div>

                    <!-- ë’¤ë¡œê°€ê¸° -->
                    <div class="text-center mt-4">
                        <a href="/" class="btn btn-outline-secondary">
                            <i class="fas fa-arrow-left me-2"></i>
                            ë©”ì¸ í˜ì´ì§€ë¡œ
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Fintree SDK -->
    <script src="https://api.fintree.kr/js/v1/pgAsistant.js" onerror="handleFintreeLoadError()"></script>

    <script>
        let diagnosticResults = [];
        let fintreeSDKLoaded = false;

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ìë™ ì§„ë‹¨
        document.addEventListener('DOMContentLoaded', function() {
            console.log('ğŸ” PC ê²°ì œ ë¬¸ì œ ì§„ë‹¨ ì‹œì‘');
            runAllDiagnostics();
        });

        // ì „ì²´ ì§„ë‹¨ ì‹¤í–‰
        function runAllDiagnostics() {
            diagnosticResults = [];
            
            // ê¸°ë³¸ í™˜ê²½ ì •ë³´ ìˆ˜ì§‘
            collectEnvironmentInfo();
            
            // ê°ì¢… í…ŒìŠ¤íŠ¸ ì‹¤í–‰
            testJavaScript();
            testPopupCapability();
            testFintreeSDK();
            testScreenSize();
            testBrowserCompatibility();
            
            // ê²°ê³¼ í‘œì‹œ
            displayResults();
            generateSolutions();
        }

        // í™˜ê²½ ì •ë³´ ìˆ˜ì§‘
        function collectEnvironmentInfo() {
            const ua = navigator.userAgent;
            
            // ë¸Œë¼ìš°ì € ê°ì§€
            let browser = 'Unknown';
            if (ua.includes('Chrome')) browser = 'Chrome';
            else if (ua.includes('Firefox')) browser = 'Firefox';
            else if (ua.includes('Safari')) browser = 'Safari';
            else if (ua.includes('Edge')) browser = 'Edge';
            
            // ë””ë°”ì´ìŠ¤ íƒ€ì…
            const isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(ua);
            const deviceType = isMobile ? 'Mobile' : 'Desktop';
            
            // í™”ë©´ í¬ê¸°
            const screenSize = `${window.screen.width}x${window.screen.height}`;
            
            // ì •ë³´ í‘œì‹œ
            document.getElementById('browserInfo').textContent = browser;
            document.getElementById('deviceType').textContent = deviceType;
            document.getElementById('screenSize').textContent = screenSize;
            document.getElementById('userAgent').textContent = ua;
            document.getElementById('jsEnabled').textContent = 'Enabled âœ…';
            
            console.log('ğŸ“Š í™˜ê²½ ì •ë³´ ìˆ˜ì§‘ ì™„ë£Œ:', { browser, deviceType, screenSize });
        }

        // JavaScript í…ŒìŠ¤íŠ¸
        function testJavaScript() {
            try {
                const testObj = { test: true };
                const testJson = JSON.stringify(testObj);
                const testParse = JSON.parse(testJson);
                
                if (testParse.test === true) {
                    addTestResult('JavaScript ê¸°ëŠ¥', 'pass', 'JavaScriptê°€ ì •ìƒì ìœ¼ë¡œ ì‘ë™í•©ë‹ˆë‹¤');
                } else {
                    addTestResult('JavaScript ê¸°ëŠ¥', 'fail', 'JavaScript JSON ì²˜ë¦¬ì— ë¬¸ì œê°€ ìˆìŠµë‹ˆë‹¤');
                }
            } catch (error) {
                addTestResult('JavaScript ê¸°ëŠ¥', 'fail', 'JavaScript ì˜¤ë¥˜: ' + error.message);
            }
        }

        // íŒì—… ê¸°ëŠ¥ í…ŒìŠ¤íŠ¸
        function testPopupCapability() {
            try {
                // íŒì—… ì°¨ë‹¨ ì—¬ë¶€ í™•ì¸
                const popup = window.open('', '_blank', 'width=1,height=1');
                if (popup && popup.location) {
                    popup.close();
                    addTestResult('íŒì—… í—ˆìš©', 'pass', 'íŒì—…ì´ í—ˆìš©ë˜ì–´ ìˆìŠµë‹ˆë‹¤');
                    document.getElementById('popupTest').textContent = 'Allowed âœ…';
                } else {
                    addTestResult('íŒì—… í—ˆìš©', 'fail', 'íŒì—…ì´ ì°¨ë‹¨ë˜ì–´ ìˆìŠµë‹ˆë‹¤ - ê²°ì œì°½ì´ ì—´ë¦¬ì§€ ì•Šì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤');
                    document.getElementById('popupTest').textContent = 'Blocked âŒ';
                }
            } catch (error) {
                addTestResult('íŒì—… í—ˆìš©', 'fail', 'íŒì—… í…ŒìŠ¤íŠ¸ ì˜¤ë¥˜: ' + error.message);
                document.getElementById('popupTest').textContent = 'Error âŒ';
            }
        }

        // Fintree SDK í…ŒìŠ¤íŠ¸
        function testFintreeSDK() {
            setTimeout(() => {
                if (typeof SendPay !== 'undefined') {
                    addTestResult('Fintree SDK', 'pass', 'Fintree SDKê°€ ì •ìƒì ìœ¼ë¡œ ë¡œë“œë˜ì—ˆìŠµë‹ˆë‹¤');
                    fintreeSDKLoaded = true;
                } else {
                    addTestResult('Fintree SDK', 'fail', 'Fintree SDK ë¡œë“œ ì‹¤íŒ¨ - ê²°ì œ ê¸°ëŠ¥ì´ ì‘ë™í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤');
                }
                displayResults();
            }, 2000); // 2ì´ˆ í›„ í™•ì¸
        }

        // í™”ë©´ í¬ê¸° í…ŒìŠ¤íŠ¸
        function testScreenSize() {
            const width = window.innerWidth;
            const height = window.innerHeight;
            
            if (width >= 1200) {
                addTestResult('í™”ë©´ í¬ê¸°', 'pass', `ë°ìŠ¤í¬í†± í•´ìƒë„ (${width}x${height})`);
            } else if (width >= 768) {
                addTestResult('í™”ë©´ í¬ê¸°', 'warn', `íƒœë¸”ë¦¿ í•´ìƒë„ (${width}x${height}) - ì¼ë¶€ ê¸°ëŠ¥ì´ ì œí•œë  ìˆ˜ ìˆìŠµë‹ˆë‹¤`);
            } else {
                addTestResult('í™”ë©´ í¬ê¸°', 'warn', `ëª¨ë°”ì¼ í•´ìƒë„ (${width}x${height}) - PCìš© ê²°ì œì°½ì— ë¬¸ì œê°€ ìˆì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤`);
            }
        }

        // ë¸Œë¼ìš°ì € í˜¸í™˜ì„± í…ŒìŠ¤íŠ¸
        function testBrowserCompatibility() {
            const ua = navigator.userAgent;
            
            if (ua.includes('Chrome')) {
                addTestResult('ë¸Œë¼ìš°ì € í˜¸í™˜ì„±', 'pass', 'Chrome - ê²°ì œ ê¸°ëŠ¥ ì™„ì „ ì§€ì›');
            } else if (ua.includes('Firefox')) {
                addTestResult('ë¸Œë¼ìš°ì € í˜¸í™˜ì„±', 'warn', 'Firefox - ì¼ë¶€ ë³´ì•ˆ ì„¤ì •ìœ¼ë¡œ ì¸í•œ ë¬¸ì œ ê°€ëŠ¥');
            } else if (ua.includes('Safari')) {
                addTestResult('ë¸Œë¼ìš°ì € í˜¸í™˜ì„±', 'warn', 'Safari - íŒì—… ë° ë³´ì•ˆ ì •ì±…ìœ¼ë¡œ ì¸í•œ ì œí•œ ê°€ëŠ¥');
            } else if (ua.includes('Edge')) {
                addTestResult('ë¸Œë¼ìš°ì € í˜¸í™˜ì„±', 'pass', 'Edge - ê²°ì œ ê¸°ëŠ¥ ì§€ì›');
            } else {
                addTestResult('ë¸Œë¼ìš°ì € í˜¸í™˜ì„±', 'fail', 'ì§€ì›ë˜ì§€ ì•ŠëŠ” ë¸Œë¼ìš°ì € - Chrome ë˜ëŠ” Edge ì‚¬ìš© ê¶Œì¥');
            }
        }

        // í…ŒìŠ¤íŠ¸ ê²°ê³¼ ì¶”ê°€
        function addTestResult(test, status, message) {
            diagnosticResults.push({ test, status, message });
        }

        // ê²°ê³¼ í‘œì‹œ
        function displayResults() {
            const resultsDiv = document.getElementById('testResults');
            resultsDiv.innerHTML = '';
            
            diagnosticResults.forEach(result => {
                const div = document.createElement('div');
                div.className = `test-result test-${result.status}`;
                
                let icon = '';
                if (result.status === 'pass') icon = 'âœ…';
                else if (result.status === 'fail') icon = 'âŒ';
                else if (result.status === 'warn') icon = 'âš ï¸';
                
                div.innerHTML = `<strong>${icon} ${result.test}:</strong> ${result.message}`;
                resultsDiv.appendChild(div);
            });
        }

        // í•´ê²° ë°©ì•ˆ ìƒì„±
        function generateSolutions() {
            const solutionsDiv = document.getElementById('solutionsList');
            const solutions = [];
            
            // íŒì—… ì°¨ë‹¨ ë¬¸ì œ
            const popupBlocked = diagnosticResults.some(r => r.test === 'íŒì—… í—ˆìš©' && r.status === 'fail');
            if (popupBlocked) {
                solutions.push('ğŸ”§ <strong>íŒì—… ì°¨ë‹¨ í•´ì œ:</strong> ë¸Œë¼ìš°ì € ì„¤ì •ì—ì„œ ì´ ì‚¬ì´íŠ¸ì˜ íŒì—…ì„ í—ˆìš©í•´ì£¼ì„¸ìš”');
                solutions.push('ğŸ”§ <strong>ì£¼ì†Œì°½ íŒì—… ì•„ì´ì½˜:</strong> ê²°ì œ ì‹œë„ ì‹œ ì£¼ì†Œì°½ ì˜† íŒì—… ì°¨ë‹¨ ì•„ì´ì½˜ì„ í´ë¦­í•˜ì—¬ í—ˆìš©í•´ì£¼ì„¸ìš”');
            }
            
            // Fintree SDK ë¬¸ì œ
            const sdkFailed = diagnosticResults.some(r => r.test === 'Fintree SDK' && r.status === 'fail');
            if (sdkFailed) {
                solutions.push('ğŸ”§ <strong>ë„¤íŠ¸ì›Œí¬ í™•ì¸:</strong> ì¸í„°ë„· ì—°ê²° ìƒíƒœë¥¼ í™•ì¸í•´ì£¼ì„¸ìš”');
                solutions.push('ğŸ”§ <strong>ë¸Œë¼ìš°ì € ìƒˆë¡œê³ ì¹¨:</strong> í˜ì´ì§€ë¥¼ ìƒˆë¡œê³ ì¹¨í•œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”');
                solutions.push('ğŸ”§ <strong>ë³´ì•ˆ í”„ë¡œê·¸ë¨:</strong> ë°©í™”ë²½ì´ë‚˜ ë³´ì•ˆ í”„ë¡œê·¸ë¨ì—ì„œ Fintree ë„ë©”ì¸ì„ í—ˆìš©í•´ì£¼ì„¸ìš”');
            }
            
            // ë¸Œë¼ìš°ì € í˜¸í™˜ì„± ë¬¸ì œ
            const browserIssue = diagnosticResults.some(r => r.test === 'ë¸Œë¼ìš°ì € í˜¸í™˜ì„±' && (r.status === 'fail' || r.status === 'warn'));
            if (browserIssue) {
                solutions.push('ğŸ”§ <strong>ê¶Œì¥ ë¸Œë¼ìš°ì €:</strong> Chrome ë˜ëŠ” Edge ë¸Œë¼ìš°ì € ì‚¬ìš©ì„ ê¶Œì¥í•©ë‹ˆë‹¤');
                solutions.push('ğŸ”§ <strong>ë¸Œë¼ìš°ì € ì—…ë°ì´íŠ¸:</strong> ìµœì‹  ë²„ì „ìœ¼ë¡œ ì—…ë°ì´íŠ¸í•´ì£¼ì„¸ìš”');
            }
            
            // ê¸°ë³¸ í•´ê²°ì±…
            solutions.push('ğŸ”§ <strong>ëª¨ë°”ì¼ ê²°ì œ:</strong> PCì—ì„œ ë¬¸ì œê°€ ì§€ì†ë˜ë©´ ëª¨ë°”ì¼ ê¸°ê¸°ë¥¼ ì‚¬ìš©í•´ì£¼ì„¸ìš”');
            solutions.push('ğŸ”§ <strong>ê³ ê°ì„¼í„°:</strong> ê³„ì† ë¬¸ì œê°€ ë°œìƒí•˜ë©´ ê³ ê°ì„¼í„°ë¡œ ë¬¸ì˜í•´ì£¼ì„¸ìš”');
            
            solutionsDiv.innerHTML = solutions.map(s => `<p class="mb-2">${s}</p>`).join('');
        }

        // Fintree SDK ë¡œë“œ ì˜¤ë¥˜ ì²˜ë¦¬
        function handleFintreeLoadError() {
            console.error('âŒ Fintree SDK ë¡œë“œ ì‹¤íŒ¨');
            addTestResult('Fintree SDK', 'fail', 'Fintree SDK ë¡œë“œ ì‹¤íŒ¨ - ë„¤íŠ¸ì›Œí¬ ë˜ëŠ” ë³´ì•ˆ ì„¤ì • í™•ì¸ í•„ìš”');
            displayResults();
            generateSolutions();
        }

        // ë²„íŠ¼ ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬
        document.getElementById('popupTestBtn').addEventListener('click', function() {
            try {
                const popup = window.open('about:blank', '_blank', 'width=400,height=300');
                if (popup) {
                    popup.document.write(`
                        <html>
                            <head><title>íŒì—… í…ŒìŠ¤íŠ¸</title></head>
                            <body style="font-family: Arial; text-align: center; padding: 50px;">
                                <h2>âœ… íŒì—… í…ŒìŠ¤íŠ¸ ì„±ê³µ!</h2>
                                <p>ê²°ì œì°½ì´ ì •ìƒì ìœ¼ë¡œ ì—´ë¦´ ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
                                <button onclick="window.close()">ë‹«ê¸°</button>
                            </body>
                        </html>
                    `);
                    setTimeout(() => popup.close(), 3000);
                } else {
                    alert('âŒ íŒì—…ì´ ì°¨ë‹¨ë˜ì—ˆìŠµë‹ˆë‹¤. ë¸Œë¼ìš°ì € ì„¤ì •ì—ì„œ íŒì—…ì„ í—ˆìš©í•´ì£¼ì„¸ìš”.');
                }
            } catch (error) {
                alert('âŒ íŒì—… í…ŒìŠ¤íŠ¸ ì˜¤ë¥˜: ' + error.message);
            }
        });

        document.getElementById('sdkTestBtn').addEventListener('click', function() {
            if (typeof SendPay !== 'undefined') {
                alert('âœ… Fintree SDKê°€ ì •ìƒì ìœ¼ë¡œ ë¡œë“œë˜ì—ˆìŠµë‹ˆë‹¤.');
            } else {
                alert('âŒ Fintree SDKê°€ ë¡œë“œë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤. í˜ì´ì§€ë¥¼ ìƒˆë¡œê³ ì¹¨í•´ì£¼ì„¸ìš”.');
            }
        });

        document.getElementById('paymentTestBtn').addEventListener('click', function() {
            if (fintreeSDKLoaded) {
                alert('âœ… ê²°ì œ ì‹œìŠ¤í…œì´ ì¤€ë¹„ë˜ì—ˆìŠµë‹ˆë‹¤. ì‹¤ì œ ê²°ì œë¥¼ ì§„í–‰í•´ë³´ì„¸ìš”.');
                window.location.href = '/payment_prepare.html';
            } else {
                alert('âŒ Fintree SDKê°€ ë¡œë“œë˜ì§€ ì•Šì•„ ê²°ì œë¥¼ ì§„í–‰í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
            }
        });
    </script>
</body>
</html>