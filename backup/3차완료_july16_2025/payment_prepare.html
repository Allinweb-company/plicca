
<!DOCTYPE html>
<html lang="ko" data-bs-theme="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ê²°ì œ ì¤€ë¹„</title>
    <link href="https://cdn.replit.com/agent/bootstrap-agent-dark-theme.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        .payment-card {
            background: linear-gradient(135deg, #1a1d23 0%, #2d3748 100%);
            border: 1px solid #4a5568;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        }
        .data-display {
            background: #2d3748;
            border-radius: 10px;
            border: 1px solid #4a5568;
            font-family: 'Courier New', monospace;
            font-size: 0.9rem;
        }
        .open-payment-btn {
            background: linear-gradient(45deg, #38a169, #2f855a);
            border: none;
            font-size: 1.2rem;
            padding: 15px 30px;
            border-radius: 10px;
            transition: all 0.3s ease;
            box-shadow: 0 5px 15px rgba(56, 161, 105, 0.3);
        }
        .open-payment-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(56, 161, 105, 0.4);
        }
        .loading-spinner {
            display: none;
        }
    </style>
</head>
<body class="bg-dark text-light">
    <div class="container py-5">
        <div class="row justify-content-center">
            <div class="col-lg-8">
                <div class="payment-card p-4 mb-4">
                    <div class="text-center mb-4">
                        <h2 class="text-info">
                            <i class="fas fa-credit-card me-2"></i>
                            ê²°ì œ ì¤€ë¹„ ì™„ë£Œ
                        </h2>
                        <p class="text-muted">ê²°ì œ ë°ì´í„°ê°€ ì¤€ë¹„ë˜ì—ˆìŠµë‹ˆë‹¤. ì•„ë˜ ì •ë³´ë¥¼ í™•ì¸ í›„ ê²°ì œë¥¼ ì§„í–‰í•˜ì„¸ìš”.</p>
                    </div>

                    <!-- ì£¼ë¬¸ ì •ë³´ í‘œì‹œ -->
                    <div id="orderSummary" class="mb-4">
                        <h5 class="text-warning mb-3">
                            <i class="fas fa-shopping-cart me-2"></i>
                            ì£¼ë¬¸ ì •ë³´
                        </h5>
                        <div class="data-display p-3">
                            <div class="row">
                                <div class="col-md-6">
                                    <p><strong>ì£¼ë¬¸ë²ˆí˜¸:</strong> <span id="orderNo" class="text-info"></span></p>
                                    <p><strong>ìƒí’ˆëª…:</strong> <span id="productName" class="text-success"></span></p>
                                    <p><strong>ìˆ˜ëŸ‰:</strong> <span id="quantity" class="text-warning"></span>ê°œ</p>
                                </div>
                                <div class="col-md-6">
                                    <p><strong>ê²°ì œê¸ˆì•¡:</strong> <span id="totalAmount" class="text-danger"></span>ì›</p>
                                    <p><strong>ì£¼ë¬¸ì:</strong> <span id="customerName" class="text-primary"></span></p>
                                    <p><strong>ì—°ë½ì²˜:</strong> <span id="customerPhone" class="text-secondary"></span></p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- ê²°ì œ ë°ì´í„° í‘œì‹œ -->
                    <div class="mb-4">
                        <h5 class="text-warning mb-3">
                            <i class="fas fa-cogs me-2"></i>
                            ê²°ì œ ë°ì´í„° (Fintree)
                        </h5>
                        <div class="data-display p-3">
                            <div class="row">
                                <div class="col-md-6">
                                    <p><strong>MID:</strong> <span id="mid" class="text-info"></span></p>
                                    <p><strong>TID:</strong> <span id="ordNoDisplay" class="text-success"></span></p>
                                    <p><strong>ê¸ˆì•¡:</strong> <span id="goodsAmt" class="text-danger"></span>ì›</p>
                                    <p><strong>ìƒí’ˆëª…:</strong> <span id="goodsNm" class="text-warning"></span></p>
                                </div>
                                <div class="col-md-6">
                                    <p><strong>ì£¼ë¬¸ìëª…:</strong> <span id="ordNm" class="text-primary"></span></p>
                                    <p><strong>ì „í™”ë²ˆí˜¸:</strong> <span id="ordTel" class="text-secondary"></span></p>
                                    <p><strong>ì´ë©”ì¼:</strong> <span id="ordEmail" class="text-info"></span></p>
                                    <p><strong>ì²˜ë¦¬ì¼ì‹œ:</strong> <span id="ediDate" class="text-muted"></span></p>
                                </div>
                            </div>
                            <div class="mt-3">
                                <p><strong>Return URL:</strong> <span id="returnUrl" class="text-success"></span></p>
                                <p><strong>Noti URL:</strong> <span id="notiUrl" class="text-warning"></span></p>
                                <p><strong>ì•”í˜¸í™” ë°ì´í„°:</strong> <span id="encData" class="text-danger text-break"></span></p>
                            </div>
                        </div>
                    </div>

                    <!-- ê²°ì œì°½ ì˜¤í”ˆ ë²„íŠ¼ -->
                    <div class="text-center">
                        <button id="openPaymentBtn" class="btn open-payment-btn btn-lg">
                            <i class="fas fa-play me-2"></i>
                            ê²°ì œì°½ ì˜¤í”ˆ
                        </button>
                        <div class="loading-spinner mt-3">
                            <div class="spinner-border text-success" role="status">
                                <span class="visually-hidden">ê²°ì œì°½ ë¡œë”© ì¤‘...</span>
                            </div>
                            <p class="mt-2">ê²°ì œì°½ì„ ì—¬ëŠ” ì¤‘ì…ë‹ˆë‹¤...</p>
                        </div>
                    </div>

                    <!-- ìˆ¨ê²¨ì§„ ê²°ì œ í¼ - ë°±ì—… ìŠ¤íƒ€ì¼ê³¼ ë™ì¼í•œ êµ¬ì¡° -->
                    <form name="payInit" id="paymentForm" method="post" style="display: none;">
                        <input type="hidden" name="payMethod" value="card">
                        <input type="hidden" name="mid" value="">
                        <input type="hidden" name="trxCd">
                        <input type="hidden" name="goodsNm">
                        <input type="hidden" name="ordNo">
                        <input type="hidden" name="goodsAmt">
                        <input type="hidden" name="ordNm">
                        <input type="hidden" name="ordTel">
                        <input type="hidden" name="ordEmail">
                        <input type="hidden" name="returnUrl">
                        <input type="hidden" name="notiUrl">
                        <input type="hidden" name="userIp">
                        <input type="hidden" name="mbsUsrId">
                        <input type="hidden" name="mbsReserved">
                        <input type="hidden" name="charSet">
                        <input type="hidden" name="ediDate">
                        <input type="hidden" name="encData">
                    </form>
                </div>

                <!-- ë’¤ë¡œê°€ê¸° ë²„íŠ¼ -->
                <div class="text-center">
                    <a href="/" class="btn btn-outline-secondary">
                        <i class="fas fa-arrow-left me-2"></i>
                        ë©”ì¸ í˜ì´ì§€ë¡œ
                    </a>
                </div>
            </div>
        </div>
    </div>

    <!-- Fintree JavaScript SDK -->
    <script src="https://api.fintree.kr/js/v1/pgAsistant.js" onerror="console.error('Fintree JS ë¡œë”© ì‹¤íŒ¨')"></script>
    
    <script>
        // â­ Webflow URL ê°ì§€ ë° ì„¤ì •
        const WEBFLOW_URL = window.location.href;
        
        // â­ ë”ë¯¸ ê²°ì œ ë°ì´í„° (ì²¨ë¶€ëœ íŒŒì¼ê³¼ ì •í™•íˆ ì¼ì¹˜)
        const DUMMY_PAYMENT_DATA = {
            "success": true,
            "ordNo": "1752386664547",
            "paymentData": {
                "mid": "mimich067m",
                "trxCd": "0",
                "goodsNm": "ìƒí’ˆìƒí’ˆ",
                "ordNo": "1752386664547",
                "goodsAmt": 132,
                "ordNm": "111ê¹€ì„±ê³¤",
                "ordTel": "01022691000",
                "ordEmail": "4u@all-in-web.kr",
                "returnUrl": "https://simple-payment-portal-gonskykim.replit.app/payment_result.php",  // â­ ì ˆëŒ€ê²½ë¡œë¡œ ìˆ˜ì •
                "notiUrl": "https://simple-payment-portal-gonskykim.replit.app/payment_notification.php",  // â­ ì ˆëŒ€ê²½ë¡œë¡œ ìˆ˜ì •
                "userIp": "172.31.128.78",
                "mbsUsrId": "api_user_150917",
                "mbsReserved": "APIRequest",
                "charSet": "UTF-8",
                "ediDate": "20250713150917",
                "encData": "93784249e2dce055dd8a64e6506c0a1574f33252d518197066d0c0c181c873fa"
            },
            "fintreeJsUrl": "https://api.fintree.kr/js/v1/pgAsistant.js",
            "summary": {
                "imOrderNo": "1752386664547",
                "productName": "ìƒí’ˆìƒí’ˆ",
                "quantity": 12,
                "unitPrice": 11,
                "totalAmount": 132,
                "customerName": "111ê¹€ì„±ê³¤",
                "customerPhone": "01022691000",
                "customerEmail": "4u@all-in-web.kr"
            }
        };

        let paymentData = null;

        // í˜ì´ì§€ ë¡œë“œ ì‹œ localStorageì—ì„œ ì‹¤ì œ ë°ì´í„° ë¡œë“œ
        document.addEventListener('DOMContentLoaded', function() {
            console.log('ğŸ”„ ê²°ì œ í˜ì´ì§€ ì´ˆê¸°í™”');
            loadPaymentData();
        });

        // localStorageì—ì„œ ì‹¤ì œ ê²°ì œ ë°ì´í„° ë¡œë“œ
        function loadPaymentData() {
            try {
                console.log('ğŸš€ localStorageì—ì„œ ê²°ì œ ë°ì´í„° ë¡œë“œ ì‹œì‘');
                
                // localStorageì—ì„œ API ê²°ì œ ë°ì´í„° ê°€ì ¸ì˜¤ê¸°
                const storedData = localStorage.getItem('paymentApiData');
                
                if (storedData) {
                    paymentData = JSON.parse(storedData);
                    console.log('âœ… localStorageì—ì„œ ì‹¤ì œ ê²°ì œ ë°ì´í„° ë¡œë“œ ì„±ê³µ:', paymentData);
                    displayPaymentData(paymentData);
                } else {
                    // localStorageì— ë°ì´í„°ê°€ ì—†ìœ¼ë©´ ë”ë¯¸ ë°ì´í„° ì‚¬ìš©
                    console.log('âš ï¸ localStorageì— ê²°ì œ ë°ì´í„° ì—†ìŒ, ë”ë¯¸ ë°ì´í„° ì‚¬ìš©');
                    paymentData = DUMMY_PAYMENT_DATA;
                    displayPaymentData(paymentData);
                }
                
            } catch (error) {
                console.error('âŒ ê²°ì œ ë°ì´í„° ë¡œë“œ ì˜¤ë¥˜:', error);
                alert('ê²°ì œ ë°ì´í„° ë¡œë“œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + error.message);
                
                // ì˜¤ë¥˜ ì‹œ ë”ë¯¸ ë°ì´í„°ë¡œ í´ë°±
                paymentData = DUMMY_PAYMENT_DATA;
                displayPaymentData(paymentData);
            }
        }

        // ê²°ì œ ë°ì´í„° í™”ë©´ í‘œì‹œ
        function displayPaymentData(data) {
            console.log('ğŸ¨ í™”ë©´ì— ë”ë¯¸ ê²°ì œ ì •ë³´ í‘œì‹œ');
            
            // ì£¼ë¬¸ ì •ë³´ í‘œì‹œ
            document.getElementById('orderNo').textContent = data.summary.imOrderNo;
            document.getElementById('productName').textContent = data.summary.productName;
            document.getElementById('quantity').textContent = data.summary.quantity;
            document.getElementById('totalAmount').textContent = data.summary.totalAmount.toLocaleString();
            document.getElementById('customerName').textContent = data.summary.customerName;
            document.getElementById('customerPhone').textContent = data.summary.customerPhone;

            // ê²°ì œ ë°ì´í„° í‘œì‹œ
            const pd = data.paymentData;
            document.getElementById('mid').textContent = pd.mid;
            document.getElementById('ordNoDisplay').textContent = pd.ordNo;
            document.getElementById('goodsAmt').textContent = parseInt(pd.goodsAmt).toLocaleString();
            document.getElementById('goodsNm').textContent = pd.goodsNm;
            document.getElementById('ordNm').textContent = pd.ordNm;
            document.getElementById('ordTel').textContent = pd.ordTel;
            document.getElementById('ordEmail').textContent = pd.ordEmail;
            document.getElementById('ediDate').textContent = pd.ediDate;
            // â­ ë³€ê²½ëœ URLì„ í™”ë©´ì— í‘œì‹œ
            document.getElementById('returnUrl').textContent = pd.returnUrl;
            document.getElementById('notiUrl').textContent = pd.notiUrl;
            document.getElementById('encData').textContent = pd.encData;

            // â­ returnUrlì„ Replit ì ˆëŒ€ ê²½ë¡œë¡œ ì„¤ì •
            pd.returnUrl = "https://simple-payment-portal-gonskykim.replit.app/payment_result.php";
            pd.notiUrl = "https://simple-payment-portal-gonskykim.replit.app/payment_notification.php";
            
            // í¼ì— ë°ì´í„° ì„¤ì • - Replit ì„œë²„ë¡œ action ì„¤ì •
            const form = document.getElementById('paymentForm');
            form.action = pd.returnUrl;
            form.payMethod.value = 'card';
            form.mid.value = pd.mid;
            form.trxCd.value = pd.trxCd;
            form.goodsNm.value = pd.goodsNm;
            form.ordNo.value = pd.ordNo;
            form.goodsAmt.value = pd.goodsAmt;
            form.ordNm.value = pd.ordNm;
            form.ordTel.value = pd.ordTel;
            form.ordEmail.value = pd.ordEmail;
            form.returnUrl.value = pd.returnUrl;
            form.notiUrl.value = pd.notiUrl;
            form.userIp.value = pd.userIp;
            form.mbsUsrId.value = pd.mbsUsrId;
            form.mbsReserved.value = pd.mbsReserved;
            form.charSet.value = pd.charSet;
            form.ediDate.value = pd.ediDate;
            form.encData.value = pd.encData;
            
            console.log('âœ… ë”ë¯¸ ë°ì´í„°ë¡œ í¼ ì„¤ì • ì™„ë£Œ:', {
                mid: form.mid.value,
                ordNo: form.ordNo.value,
                goodsAmt: form.goodsAmt.value,
                encData: form.encData.value.substring(0, 20) + '...'
            });
        }

        // ê²°ì œì°½ ì˜¤í”ˆ (ë”ë¯¸ ë°ì´í„° ì‚¬ìš©)
        document.getElementById('openPaymentBtn').addEventListener('click', function() {
            try {
                // Fintree SDK í™•ì¸
                if (typeof SendPay === 'undefined') {
                    console.error('SendPay í•¨ìˆ˜ê°€ ì •ì˜ë˜ì§€ ì•ŠìŒ - Fintree JS ë¡œë”© ì‹¤íŒ¨');
                    alert('Fintree ê²°ì œ ë¼ì´ë¸ŒëŸ¬ë¦¬ê°€ ë¡œë”©ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤. í˜ì´ì§€ë¥¼ ìƒˆë¡œê³ ì¹¨ í•´ì£¼ì„¸ìš”.');
                    return;
                }

                // ê²°ì œ ë°ì´í„° í™•ì¸
                if (!paymentData) {
                    alert('ê²°ì œ ë°ì´í„°ê°€ ì¤€ë¹„ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.');
                    return;
                }

                console.log('ğŸš€ ê²°ì œì°½ ì˜¤í”ˆ');
                console.log('ğŸ“‹ ê²°ì œ ë°ì´í„°:', paymentData);
                console.log('âœ… SendPay í•¨ìˆ˜ í™•ì¸:', typeof SendPay);

                // ë¡œë”© í‘œì‹œ
                document.querySelector('.loading-spinner').style.display = 'block';
                this.style.display = 'none';

                // ê²°ì œì°½ ì˜¤í”ˆ
                SendPay(document.getElementById('paymentForm'));
                
            } catch (error) {
                console.error('âŒ ê²°ì œì°½ ì˜¤í”ˆ ì˜¤ë¥˜:', error);
                alert('ê²°ì œì°½ì„ ì—¬ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + error.message);
                
                // ë²„íŠ¼ ë³µì›
                document.querySelector('.loading-spinner').style.display = 'none';
                this.style.display = 'block';
            }
        });

        // ê²°ì œ ì™„ë£Œ ì½œë°± - Fintree SDKì˜ payResultSubmit() í˜¸ì¶œ
        function pay_result_submit() {
            console.log('âœ… ê²°ì œ ì™„ë£Œ - Fintree ê²°ì œ ê²°ê³¼ ì²˜ë¦¬');
            
            // Fintree SDKì˜ payResultSubmit í•¨ìˆ˜ í˜¸ì¶œ
            // ì´ í•¨ìˆ˜ê°€ ì‹¤ì œ ê²°ì œ ê²°ê³¼ë¥¼ payment_result.phpë¡œ POST ì „ì†¡
            payResultSubmit();
        }
        
        // ê²°ì œ ì·¨ì†Œ ì½œë°±
        function pay_result_close() {
            console.log('âŒ ë”ë¯¸ ë°ì´í„° ê²°ì œ ì·¨ì†Œ');
            document.querySelector('.loading-spinner').style.display = 'none';
            document.getElementById('openPaymentBtn').style.display = 'block';
            alert('ë”ë¯¸ ë°ì´í„° ê²°ì œë¥¼ ì·¨ì†Œí•˜ì˜€ìŠµë‹ˆë‹¤.');
        }
    </script>
</body>
</html>
